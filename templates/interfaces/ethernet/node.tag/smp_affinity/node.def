#
#
# Configuration template for interface.ethernet.name.smp_affinity
#
# Configure the CPUs that the associated interface will interrupt.
# SMP affinity is configured by a hexidecimal bitmask that specifies the
# CPUs that the system can interrupt.  The SMP affinity bitmask must contain
# at least one bits, and may only contain as many bits as there are CPUs on
# the system.
#

type: txt

help: Set CPU interrupt affinity mask for this interface

comp_help: Hexidecimal bitmask representing CPUs that this NIC will interrupt

syntax:expression: exec "/opt/vyatta/sbin/vyatta-irqaffin check $VAR(../@) $VAR(@)"

update:
	sudo /opt/vyatta/sbin/vyatta-irqaffin set $VAR(../@) $VAR(@)
	if [ $? -ne 0 ]; then
	   echo "Error setting CPU affinity mask $VAR(@) on interface $VAR(../@)"
	   exit 1
	fi

delete: [ -d /sys/class/net/$VAR(../@) ] || exit 0
	if ! sudo /opt/vyatta/sbin/vyatta-irqaffin reset $VAR(../@); then
	    echo "Error deleting CPU affinity mask on interface $VAR(../@)"
	    exit 1
	fi
